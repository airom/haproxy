global
  user <%= @user %>
  group <%= @group %>
  pidfile <% @pid_file %>
  log <%= @log %>
  maxconn <%= @maxconn %>
  <%= if @daemon %>daemon<% end %>
  <% @debug_option %>
  <%= if @enable_stats_socket %>
  stats socket /var/run/haproxy.sock user <% @user %> group <% @group %>
  <% end %>
  <%= @extra_options.each do |option,value| %>
  <%= option %> <%= value %>
  <% end %>

defaults
  log     global
  mode    <%= @mode %>
  retries <%= @defaults_retries %>
<% @defaults_timeouts.sort.map do | value, time | -%>
  timeout <%= value %> <%= time %>
<% end -%>
<% @defaults_options.sort.each do | option | -%>
  option <%= option %>
<% end -%>
  balance  <%= @balance_algorithm %>

# Set up application listeners here.

<% node['haproxy']['listeners'].each do |type, listeners | %>
<% listeners.each do |name, listen| %>
<%= type %> <%= name %>
<% listen.each do |option| %>
  <%= option %>
<% end %>

<% end %>

<% end %>
